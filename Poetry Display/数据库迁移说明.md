# 数据库迁移和注册逻辑修改说明

## 已完成的前端代码修改

### 1. 注册逻辑优化
- **文件**: `src/stores/auth.ts`
- **修改内容**: 
  - 禁用邮件验证，实现直接注册
  - 注册后自动登录用户
  - 在profiles表中保存password_hash字段

### 2. 类型定义更新
- **文件**: `src/lib/supabase.ts`
- **修改内容**: 为profiles表添加password_hash字段的类型定义

### 3. 环境配置
- **文件**: `.env`
- **修改内容**: 添加禁用邮件验证的环境变量

## 需要执行的数据库迁移

### 迁移文件位置
- `supabase_migrations/add_password_to_profiles.sql` - 添加password_hash字段的SQL脚本
- `supabase_migrations/README.md` - 迁移执行说明

### 执行步骤

1. **登录Supabase控制台**
   - 访问: https://supabase.com/dashboard
   - 选择项目: muzyfqxxafqqqgaqvhlu

2. **执行SQL迁移**
   - 进入 **SQL Editor**
   - 新建查询
   - 复制并执行 `add_password_to_profiles.sql` 中的SQL代码

3. **验证迁移结果**
   - 在 **Table Editor** 中查看profiles表结构
   - 确认password_hash字段已添加

## 功能特性

### 注册流程优化
- ✅ 直接注册，无需邮件验证
- ✅ 注册后自动登录
- ✅ 密码保存到profiles表
- ✅ 完善的错误处理

### 安全考虑
- 在实际生产环境中，建议使用bcrypt等安全哈希算法处理密码
- 当前实现简化处理，直接存储明文用于演示

## 测试验证

1. 启动开发服务器: `npm run dev`
2. 访问注册页面进行测试
3. 验证用户注册后能否直接登录
4. 检查profiles表中是否包含password_hash数据

## 注意事项

- 数据库迁移需要在Supabase控制台中手动执行
- 迁移脚本包含安全检查，避免重复执行
- 前端代码已准备就绪，等待数据库结构更新